# 			光照和渲染简介

**全局光照（GI）**：全局光照是描述一系列技术和数学模型的术语，以便模拟光线在世界中弹射的复杂行为。

### 实时光照

​	默认情况下，Unity中的光源都是实时光源。这样的光源为场景提供直接光照，并且每帧都会根据场景内当前的状态来更新。提供实时光照，是光源对象最基本的作用，可以用来照亮场景内移动的对象。然而，实时光源提供的光照射线是不会在对象间弹射的。要创建出更真实的场景，就要使用全局光照技术。

### 烘培全局光照（Baked GI lighting）

​	使用烘培全局光照技术，有一个烘培光照的过程，完成后，场景内静态对象上的光照效果会被保存为光照贴图，然后，在运行时，把这些光照贴图覆盖到场景内对象的表面上来得到比较接近真实的光照效果。光照贴图可以包含来自光源的“直接光照”，也可以包含来自其他静态对象弹射过来的”间接光照”。烘培光照在运行时是无法做改变的，所以也被称为“静态”的光照。实时光源产生的光照效果可以叠加在场景内渲染好的光照贴图之上，但是无法修改光照贴图产生的效果。

### 实时全局光照（Realtime GI lighting）

​	由于传统的烘培全局光照无法在运行时光照条件改变的时候进行更新，于是，Unity提供了一种新的叫做实时全局光照的技术，通过这种技术可以产生实时的根据光照变化而变化的全局光照。要获得实时光照的效果，会需要比较大的计算量，为了防止大量的光照计算对设备造成过大压力使得游戏无法正常运行，实时全局光照有一个预计算的阶段，和烘培全局光照的烘培阶段有点类似，这个阶段会对光线的行为进行计算，这个预计算阶段是在开发阶段进行的，毕竟开发阶段的时间还是比较充裕的。

​	大部分情况下，在模拟真实世界光照时我们希望保存进光照贴图中的是间接光照，而这种光照的颜色一般不会变化的太剧烈。Unity的预计算实时全局光照解决方案充分利用了间接光照这个“漫反射”特性。好的光照细节，例如清晰的阴影，最好是通过实时的直接光照计算生成，而不是烘培在光照贴图中的。因为，使用实时全局光照技术场景内对象的阴影是实时生成的，所以，在它的预计算阶段不需要保存很精细的光照细节,因此，实时全局光照预计算生成的光照贴图的分辨率可以比较低。有了这种优化，可以大量的减少运行时全局光照的计算量。有利于我们在运行时修改光源的属性，改变场景内的光照效果。通常，计算全局光照是通过对光源发出的光线进行射线跟踪得到的，而如果这个计算在运行时进行的话，会对游戏性能造成很大压力。所以，Unity把这个计算改在预计算的时候进行。

### 选择全局光照方案

​	虽然，可以在同一个场景中同时使用烘培全局光照和实时全局光照这两个技术，但是并不推荐这样做。因为，同时使用这两项技术方案，不但意味着在运行时的时候会要在显存中保存两份光照贴图集，并且还要shader中对这些贴图进行解码运算，对硬件资源造成很大压力。所以，最好根据项目的需求和运行的目标硬件来选择一种光照技术方案。例如，如果目标硬件是配置比较低的，可以选择烘培全局光照；如果目标硬件是配置比较高的，有不错的显卡，可以使用实时全局光照。

### 开始预计算

​	无论是烘培全局光照还是实时全局光照，你都可以通过光照设置窗口的设置来让Unity编辑器来进行全局光照的预计算过程。你可以选择手动也可以让编辑器自动开始这个过程。但是，首先你的场景中至少要有一个游戏对象是被标记为光照贴图静态的，因为全局光照的预计算主要是针对静态对象进行的。

### 渲染路径

​	Unity支持多种渲染路径技术，一般在新建一个项目的时候，就会决定使用哪种渲染路径技术，Unity默认使用的是前向渲染（Forward Rendering）

	##### 	前向渲染（Forward Rendering）

​	在前向渲染中，一个对象针对每一个影响他的光源都会在shader的“pass”中渲染一次，因此，一个对象渲染几次由影响它的光源数目来决定。这种渲染方式的好处是渲染速度很快，并且，相对于其他的渲染技术方式对硬件的要求最低。还有是这种方式提供了很多定制好的光照模型可以使用。它还能有效利用硬件提供的反锯齿技术来改善渲染效果。而这种方式最大的坏处是，每多一个影响对象的光源，就多一次渲染消耗，也就会导致影响对象的光源越多渲染将会越慢。也就意味着使用这种渲染技术时，游戏中不能有过多的光源。所以，当游戏中光源数量很有限的情况下，前向渲染将是一种很好的选择。

	##### 	延迟渲染

​	在延迟渲染中，光照效果是延迟到场景内的对象渲染成了屏幕空间的一系列纹理之后再混合进去的。这种渲染方式最本质的好处是，渲染光照效果的消耗将依赖于光照影响的像素比例，而跟光源的数量没什么关系。这就意味着，对游戏场景内的光源数量将不再有限制。同时，也可以看出延迟渲染将有更高的渲染性能。不过，并不是所有硬件都支持延迟渲染。

### 颜色空间

​	在为项目选择好渲染路径方式之后，为项目选择好颜色空间方案也很重要。因为，颜色空间决定了使用什么样的数学算法用于光照计算中的颜色混合，同时，也决定了如何从纹理中读取值。颜色空间对游戏模拟真实世界有很重要的影响。选择什么样的颜色空间，大部分情况由你的游戏的目标平台的硬件决定。

##### 	线性颜色空间

​	使用线性颜色空间进行渲染，渲染效果将更接近现实世界。线性颜色空间的重要优点是，当光源的光照强度线性增强时，传给shader的颜色值也是线性变亮的。线性颜色空间的另一个好处时，它的shader对纹理进行采样得到的颜色值将不会有Gamma补偿，这样在所有渲染管线中的颜色值将是一致的，这样在渲染管线中进行的颜色计算将更加精确，更有利于渲染出接近真实世界的效果。

##### 	Gamma颜色空间

​	使用Gamma颜色空间，当光源的光照强度线性增强时，颜色值会迅速变白。

然而，并不是所有的硬件都支持线性颜色空间，有一些移动设备并不支持线性颜色空间。所以，在选择颜色空间方案时，先确保你的目标平台支持该颜色空间技术。